<!doctype html>
<html lang="en">

    <head>
        <title>{% block title %}{% endblock %}</title>
        <meta charset="utf-8"/>

        <link rel="shortcut icon" href="#">

        <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}" type="text/css"/>
        <link rel="stylesheet" href="{{ url_for('static', path='css/theme.css') }}" type="text/css"/>
        <link rel="stylesheet" href="{{ url_for('static', path='css/custom.css') }}" type="text/css"/>
        <link rel="stylesheet" href="{{ url_for('static', path='css/exchanges.css') }}" type="text/css"/>

        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" type="text/css"/>

        <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/web-socket-js/1.0.0/web_socket.min.js"></script>

        <script>
            function createElement(obj) {
                const span = document.createElement("span");

                if (obj.is_seller === false) {
                    span.className = "order_buy";
                } else {
                    span.className = "order_sell";
                }

                span.innerHTML = ` ${obj.message} \n`;
                return span
            }

            function addRow(obj) {
                const elem = createElement(obj)

                const selector = '#messages';

                $(`${selector}`).prepend(elem);

                const length = $(selector).find('span').length;
                if (length > {{ max_rows * 2 }}) {
                    $(`${selector} > span:last`).remove();
                }
            }

            function retrieveData() {
                $.get('{{ http_url }}').done(function (response) {
                    for (const obj of response.r) {
                        addRow(obj);
                    }
                })
            }

            function setupAndStartWS() {
                const ws = new WebSocket("{{ websocket_url }}");

                ws.onopen = (event) => {
                    console.log("connection is open")
                };

                ws.onclose = (event) => {
                    console.log("connection is close")
                };

                ws.onmessage = function (event) {
                    console.log("onmessage")
                    const obj = JSON.parse(event.data);
                    setPageTitle(obj);
                    addRow(obj);
                }

                ws.onclose = function(e) {
                    console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
                    setTimeout(function() {
                        setupAndStartWS()
                    }, 1000);
                };

                ws.onerror = function(err) {
                    console.error('Socket encountered error: ', err.message, 'Closing socket');
                    ws.close();
                };
            }
        </script>
        <script>
            $(document).ready(function() {
                setupAndStartWS();
                retrieveData();
            });
        </script>
        <script>
            $(document).ready(function () {
                const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
                const currentTheme = localStorage.getItem('theme') || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");

                if (currentTheme) {
                    document.documentElement.setAttribute('data-theme', currentTheme);
                    console.log(document.documentElement.getAttribute('data-theme'));

                    if (currentTheme === 'dark') {
                        toggleSwitch.checked = true;
                    }
                }

                function switchTheme(e) {
                    if (e.target.checked) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.documentElement.setAttribute('data-theme', 'light');
                        localStorage.setItem('theme', 'light');
                    }
                }

                toggleSwitch.addEventListener('change', switchTheme, false);
            });
        </script>

        {% block javascript %}{% endblock %}
    </head>

    <body>
        <div class="padded-boxes">
            <section>
                <div class="padded">
                    <!-- box 1 content -->
<pre>
------------------------------------------------------------------------------------------------------------
       <b>DATETIME      | EXCHANGE |        PRICE        |          QUANTITY          |          TOTAL</b>
------------------------------------------------------------------------------------------------------------
<span id="messages"></span></pre>
                </div>
            </section>
            <section class="right">
                <div class="padded">
                    <!-- box 2 content -->
<pre>

<b>Exchanges:</b>

{{ exchanges }}


<b>Bitcoin:</b>

<a href="/BTC">BTC all trades</a>
<a href="/BTC/octopuses">BTC octopus trades</a>
<a href="/BTC/dolphins">BTC dolphin trades</a> ðŸ’¾
<a href="/BTC/whales">BTC whale trades</a> ðŸ’¾

<b>Ethereum:</b>

<a href="/ETH">ETH all trades</a>
<a href="/ETH/octopuses">ETH octopus trades</a>
<a href="/ETH/dolphins">ETH dolphin trades</a> ðŸ’¾
<a href="/ETH/whales">ETH whale trades</a> ðŸ’¾

<b>Chainlink:</b>

<a href="/LINK">LINK all trades</a>
<a href="/LINK/octopuses">LINK octopus trades</a>
<a href="/LINK/dolphins">LINK dolphin trades</a> ðŸ’¾
<a href="/LINK/whales">LINK whale trades</a> ðŸ’¾

<b>Fantom:</b>

<a href="/FTM">FTM all trades</a>
<a href="/FTM/octopuses">FTM octopus trades</a>
<a href="/FTM/dolphins">FTM dolphin trades</a> ðŸ’¾
<a href="/FTM/whales">FTM whale trades</a> ðŸ’¾

<b>Pepe:</b>

<a href="/PEPE">PEPE all trades</a>
<a href="/PEPE/octopuses">PEPE octopus trades</a>
<a href="/PEPE/dolphins">PEPE dolphin trades</a> ðŸ’¾
<a href="/PEPE/whales">PEPE whale trades</a> ðŸ’¾

<b>LTO Network:</b>

<a href="/LTO">LTO all trades</a> ðŸ’¾
<a href="/LTO/octopuses">LTO octopus trades</a> ðŸ’¾
<a href="/LTO/dolphins">LTO dolphin trades</a> ðŸ’¾
<a href="/LTO/whales">LTO whale trades</a> ðŸ’¾



*octopus -> More than 1,000 USD/USDT or 0.04 BTC or 0.6 ETH in a single transaction
*dolphin -> More than 10,000 USD/USDT or 0.4 BTC or 6 ETH in a single transaction
*whale -> More than 100,000 USD/USDT or 4 BTC or 60 ETH in a single transaction


<div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
        <input type="checkbox" id="checkbox"/>
        <div class="slider round"></div>
    </label>
    <em>Dark Mode</em>
</div>

</pre>
                </div>
            </section>
        </div>
    </body>

</html>
